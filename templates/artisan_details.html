<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>"{{ .ArtisanDetails.Name }}" Artisan Info - CMOC Control Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link href="/assets/output.css" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/favicon-16x16.png" />
<link rel="manifest" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/site.webmanifest" />
<link rel="mask-icon" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/safari-pinned-tab.svg" color="#5bbad5" />
<link rel="shortcut icon" href="https://www.wiilink24.comhttps://www.wiilink24.com/img/favicon.ico" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-config" content="https://www.wiilink24.comhttps://www.wiilink24.com/img/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />
    <script src="https://kit.fontawesome.com/e47ece3e74.js" crossorigin="anonymous"></script>
</head>
<body class="dark:text-white dark:bg-slate-800">
    <main class="container py-20 space-y-4">
      <div class="pb-2 flex items-center justify-between">
        <div class="flex flex-row gap-3 items-center">
          <img
            src="https://www.wiilink24.com/img/IS-logo.png"
            class="!h-[60px] dark:invert"
          />
          <i
            class="fa-solid fa-chevron-right text-2xl cursor-pointer"
            onclick="toggleOpen('toggleOpen');"
          ></i>
          <div
            id="toggleOpen"
            class="p-2 flex-row items-center gap-3 rounded-xl bg-gray-50 dark:bg-slate-500 hidden"
          >
            <a href="/panel/contests"
              ><button
                class="p-2 hover:bg-gray-300 dark:hover:bg-slate-800 rounded-md transition-all"
              >
                <i class="fa-solid fa-flag-checkered"></i> Contests
              </button></a
            >
            |
            <a href="/panel/contests/add"
              ><button
                class="p-2 hover:bg-gray-200 dark:hover:bg-slate-800 rounded-md transition-all"
              >
                <i class="fa-solid fa-circle-plus"></i> Add Contest
              </button></a
            >
            |
            <a href="/panel/plaza"
              ><button
                class="p-2 hover:bg-gray-200 dark:hover:bg-slate-800 rounded-md transition-all"
              >
                <i class="fa-solid fa-users"></i> Plaza
              </button></a
            >
            |
            <a href="/panel/artisans"
              ><button
                class="p-2 bg-gray-200 dark:bg-slate-600 hover:bg-gray-200 dark:hover:bg-slate-800 rounded-md transition-all"
              >
                <i class="fa-solid fa-brush"></i> Mii Artisans
              </button></a
            >
          </div>
        </div>
        <h2 class="text-right text-lg">
          <b>CMOC</b><br />
          Control Panel
        </h2>
      </div>
      <hr class="pt-2" />
      <div class="flex items-center justify-between">
        <a
        class="col-span-2 inline-flex gap-3 items-center"
        href="/panel/artisans"
        ><i class="fa-solid fa-chevron-left"></i>
        <p class="hover:underline">Return to Mii Artisans</p></a
      >
        <p class="opacity-50">
          CMOC <i class="fa-solid fa-caret-right"></i> Mii Artisans
          <i class="fa-solid fa-caret-right"></i> {{ .ArtisanDetails.ArtisanId }}
        </p>
      </div>

        <div class="flex flex-col gap-3 rounded-xl">
            <div class="flex flex-row items-center justify-between">
                <div class="flex flex-row items-center">
                    <p class="miiData hidden">{{ .ArtisanDetails.MiiDataEncoded }}</p>
                    <img src="" class="miiImage h-28" />
                    <div class="flex flex-col">
                        <p class="flag text-9xl"></p>
                        <h1 class="flex flex-row items-center gap-3">
                            {{ .ArtisanDetails.Name }}
                            <p class="opacity-30 font-normal font-serif">{{ .ArtisanDetails.ArtisanId }}</p>
                        </h1>
                        <div class="pt-2 flex flex-row">
                            <p class="master">{{ .ArtisanDetails.IsMaster }}</p>
                            <p class="country">{{ .ArtisanDetails.CountryId }}</p>
                        </div>
                    </div>
                </div>
                <div class="mr-6 flex flex-row gap-3">
                    <p class="text-4xl">
                        <i class="fa-solid fa-angle-up"></i> {{ .ArtisanDetails.TotalLikes }}
                    </p>
                </div>
            </div>
            <div class="pb-3 flex flex-row items-center justify-between">
                <p class="flex flex-col text-xl">
                    <span class="opacity-30 text-sm">Wii Number</span>{{ .ArtisanDetails.WiiNumber }}
                </p>
                <div class="flex flex-row items-center">
            <p class="flex flex-col justify-end text-right">
              <span class="opacity-30 text-sm">Last posted on </span>
              <span class="lastPost">
                {{ .ArtisanDetails.LastPost }}  
              </span>         
                <div class="ml-5 mr-5 flex flex-row gap-3 items-center">
                    <p
                      class="p-1 pl-3 pr-3 bg-gray-300 text-gray-300 dark:bg-slate-700 dark:text-slate-700 active:bg-white active:text-black transition-all rounded-full text-center"
                    >
                    Mac Address: {{ .ArtisanDetails.MacAddress }}
                    </p>
                    <i
                      class="fa-regular fa-circle-question opacity-60 cursor-pointer"
                      title="Keep clicked to reveal this user's Mac Address"
                    ></i>
                  </div>
            </p>
        </div>
            </div>
        </div>
        <hr class="pb-3 opacity-5">
        <div class="mt-6 mb-3 flex flex-row items-center justify-between">
        <h1>Miis</h1>
        <h2 class="opacity-60"><b>{{ .ArtisanDetails.Name }}</b> has sbumitted <b>{{ .numberOfMiis }}</b> Miis.</h2>
    </div>
        <div class="grid magic_grid gap-3">
            {{ range .Miis }}
            <div class="flex flex-col gap-3 rounded-xl border-2 border-gray-100 bg-gray-50 dark:border-slate-600 dark:bg-slate-700 hover:scale-102 hover:shadow-lg transition-all">
                <a href="/panel/plaza/details/{{.EntryId}}" class="flex flex-row items-center justify-between">
                    <div class="flex flex-row items-center">
                        <p class="miiData hidden">{{.MiiDataEncoded}}</p>
                        <img src="" class="miiImage h-28" />
                        <div class="flex flex-col">
                            <p class="flag text-9xl"></p>
                            <h1 class="flex flex-row items-center gap-3">
                                {{.Nickname}}
                                <p class="opacity-30 font-normal font-serif">{{.Initials}}</p>
                            </h1>
                            <div class="flex flex-row gap-3">
                                <p class="gender">{{.Gender}}</p> |
                                <p class="country">{{.CountryId}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mr-6 flex flex-row gap-3">
                        <p class="text-xl">
                            <i class="fa-solid fa-angle-up"></i> {{.Likes}}
                        </p>
                        <p class="text-xl">
                            <i class="fa-solid fa-angles-up"></i> {{.PermLikes}}
                        </p>
                    </div>
                </a>
                <button class="delete_button" onclick='deleteEntry("{{.EntryId}}")'>
                    <i class="fa-solid fa-trash"></i> Delete this Mii
                </button>
                <p class="mr-5 mb-5 opacity-30 text-right">
                    {{.EntryId}} | {{.MiiId}}
                    <i class="fa-solid fa-fingerprint"></i>
                </p>
            </div>
            {{ else }}
            <div class="flex justify-center items-center">
                <p class="mt-3 text-xl opacity-60 text-center"><i class="fa-solid fa-triangle-exclamation text-6xl"></i><br><br>{{ .ArtisanDetails.Name }} has shared no Miis. Once they do, they will be displayed here.</p>
            </div>
            {{ end }}
        </div>
        <br />
        <hr />
        <p class="pt-2">Â©2020 - 2024 WiiLink Team</p>
    </main>
</body>

<script>
        function deleteEntry(entryId) {
      // Ask for confirmation
      const isConfirmed = confirm("Are you sure you want to delete this Mii? This action cannot be undone.");
      
      // Proceed only if the user confirmed
      if (isConfirmed) {
        fetch(`/panel/plaza/delete/${entryId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        }).then((response) => {
          if (response.ok) {
            window.location.reload();
          } else {
            alert("Failed to delete entry.");
          }
        });
      }
    }

    document.addEventListener("DOMContentLoaded", async function () {
      const miiElements = document.querySelectorAll(".miiData"); // Select all elements with the class 'miiData'
      miiElements.forEach(async (miiElement) => {
        const base64String = miiElement.innerHTML; // Assuming the base64 string is directly within the element
        if (base64String) {
          try {
            const miiImageUrl = await renderMii(base64String);
            console.log(miiImageUrl);
            // Assuming there's a way to associate the miiImage with the miiElement, like a data attribute or adjacent element
            const imgElement = miiElement.nextElementSibling; // Example: the <img> is right next to the miiElement
            imgElement.src = miiImageUrl;
          } catch (error) {
            console.error("Failed to render Mii:", error);
          }
        }

        document.querySelectorAll(".lastPost").forEach((element) => {
          // Parse the date string
          const dateString = element.textContent.trim(); // Assuming the format "2024-06-17 12:51:36 +0000 UTC"
          const dateParts = dateString.split(" ");
          const date = new Date(dateParts[0] + "T" + dateParts[1] + "Z"); // Convert to ISO format

          // Format the date and time
          const formattedDate = date.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
            timeZoneName: "short",
          });

          // Update the element's text
          element.textContent = formattedDate;
        });


        const ids = ["toggleOpen"];
        ids.forEach((id) => {
          const element = document.getElementById(id);
          const state = localStorage.getItem(id);
          if (state === "open") {
            element.style.display = "flex";
          } else if (state === "closed") {
            element.style.display = "none";
          }
        });
      });

      const countryElements = document.querySelectorAll(".country"); // Select all elements with the class 'country'
      countryElements.forEach((countryElement) => {
        const countryCode = parseInt(countryElement.innerHTML); // Assuming the country code is directly within the element
        if (!isNaN(countryCode)) {
          const countryName = getCountryName(countryCode);
          countryElement.innerHTML = countryName.flag + " " + countryName.name;
        }
      });

      const masterElements = document.querySelectorAll(".master");
      masterElements.forEach((masterElement) => {
        const isMaster = masterElement.innerHTML;
        const masterName = checkIsMaster(isMaster);
        masterElement.innerHTML = masterName;
        console.log(masterName);
      });

      const genderElements = document.querySelectorAll(".gender");
      genderElements.forEach((genderElement) => {
        const gender = parseInt(genderElement.innerHTML);
        const genderName = getGender(gender);
        genderElement.innerHTML = genderName;
      });
    });

    function renderMii(base64String) {
      // Decode base64 string
      let binaryString = atob(base64String);
      let binaryLen = binaryString.length;
      // Create binary array from base64 decoded string
      let bytes = new Uint8Array(binaryLen);
      // Fill the binary array
      for (let i = 0; i < binaryLen; i++) {
        let ascii = binaryString.charCodeAt(i);
        bytes[i] = ascii;
      }

      // Create a blob object
      let blob = new Blob([bytes], { type: "application/octet-stream" });

      // Create a file object from the blob
      let file = new File([blob], "file.miigx");

      // Send the file to the server
      let formData = new FormData();
      formData.append("platform", "wii");
      formData.append("data", file);

      // Use larsen's funky studio.cgi to get the data needed to render the mii
      return fetch("https://miicontestp.wii.rc24.xyz/cgi-bin/studio.cgi", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          let mii = data.mii;

          // Render the mii using Nintendo's servers
          var src =
            "https://studio.mii.nintendo.com/miis/image.png?data=" +
            mii +
            "&type=face_only&expression=normal&width=270&bgColor=FFFFFF00";

          // Return the mii image
          return src;
        });
    }

    function getGender(gender) {
      switch (gender) {
        case 1:
          return "<i class='fa-solid fa-person'></i>";
        case 2:
          return "<i class='fa-solid fa-person-dress'></i>";
        case 3:
          return "<i class='fa-solid fa-circle-question'></i>";
      }
    }

    function checkIsMaster(isMaster) {
      console.log(isMaster);
      if (isMaster == "true") {
        return "<span class='mr-3 p-1 pl-2 pr-2 rounded-full text-white' style='background-color:orange;'>â Master â</span>";
      } else {
        return "";
      }
    }

    function getCountryName(countryCode) {
      switch (countryCode) {
        case 1:
          return { flag: "ð¯ðµ", name: "Japan" };

        case 8:
          return { flag: "ð¦ð®", name: "Anguilla" };
        case 9:
          return { flag: "ð¦ð¬", name: "Antigua and Barbuda" };
        case 10:
          return { flag: "ð¦ð·", name: "Argentina" };
        case 11:
          return { flag: "ð¦ð¼", name: "Aruba" };
        case 12:
          return { flag: "ð§ð¸", name: "Bahamas" };
        case 13:
          return { flag: "ð§ð§", name: "Barbados" };
        case 14:
          return { flag: "ð§ð¿", name: "Belize" };
        case 15:
          return { flag: "ð§ð´", name: "Bolivia" };
        case 16:
          return { flag: "ð§ð·", name: "Brazil" };
        case 17:
          return { flag: "ð»ð¬", name: "British Virgin Islands" };
        case 18:
          return { flag: "ð¨ð¦", name: "Canada" };
        case 19:
          return { flag: "ð°ð¾", name: "Cayman Islands" };
        case 20:
          return { flag: "ð¨ð±", name: "Chile" };
        case 21:
          return { flag: "ð¨ð´", name: "Colombia" };
        case 22:
          return { flag: "ð¨ð·", name: "Costa Rica" };
        case 23:
          return { flag: "ð©ð²", name: "Dominica" };
        case 24:
          return { flag: "ð©ð´", name: "Dominican Republic" };
        case 25:
          return { flag: "ðªð¨", name: "Ecuador" };
        case 26:
          return { flag: "ð¸ð»", name: "El Salvador" };
        case 27:
          return { flag: "ð«ð·", name: "French Guiana" };
        case 28:
          return { flag: "ð¬ð©", name: "Grenada" };
        case 29:
          return { flag: "ð¬ðµ", name: "Guadeloupe" };
        case 30:
          return { flag: "ð¬ð¹", name: "Guatemala" };
        case 31:
          return { flag: "ð¬ð¾", name: "Guyana" };
        case 32:
          return { flag: "ð­ð¹", name: "Haiti" };
        case 33:
          return { flag: "ð­ð³", name: "Honduras" };
        case 34:
          return { flag: "ð¯ð²", name: "Jamaica" };
        case 35:
          return { flag: "ð²ð¶", name: "Martinique" };
        case 36:
          return { flag: "ð²ð½", name: "Mexico" };
        case 37:
          return { flag: "ð²ð¸", name: "Montserrat" };
        case 38:
          return { flag: "ð³ð±", name: "Netherlands Antilles" };
        case 39:
          return { flag: "ð³ð®", name: "Nicaragua" };
        case 40:
          return { flag: "ðµð¦", name: "Panama" };
        case 41:
          return { flag: "ðµð¾", name: "Paraguay" };
        case 42:
          return { flag: "ðµðª", name: "Peru" };
        case 43:
          return { flag: "ð°ð³", name: "St. Kitts and Nevis" };
        case 44:
          return { flag: "ð±ð¨", name: "St. Lucia" };
        case 45:
          return { flag: "ð»ð¨", name: "St. Vincent and the Grenadines" };
        case 46:
          return { flag: "ð¸ð·", name: "Suriname" };
        case 47:
          return { flag: "ð¹ð¹", name: "Trinidad and Tobago" };
        case 48:
          return { flag: "ð¹ð¨", name: "Turks and Caicos Islands" };
        case 49:
          return { flag: "ðºð¸", name: "United States" };
        case 50:
          return { flag: "ðºð¾", name: "Uruguay" };
        case 51:
          return { flag: "ð»ð®", name: "US Virgin Islands" };
        case 52:
          return { flag: "ð»ðª", name: "Venezuela" };

        case 64:
          return { flag: "ð¦ð±", name: "Albania" };
        case 65:
          return { flag: "ð¦ðº", name: "Australia" };
        case 66:
          return { flag: "ð¦ð¹", name: "Austria" };
        case 67:
          return { flag: "ð§ðª", name: "Belgium" };
        case 68:
          return { flag: "ð§ð¦", name: "Bosnia and Herzegovina" };
        case 69:
          return { flag: "ð§ð¼", name: "Botswana" };
        case 70:
          return { flag: "ð§ð¬", name: "Bulgaria" };
        case 71:
          return { flag: "ð­ð·", name: "Croatia" };
        case 72:
          return { flag: "ð¨ð¾", name: "Cyprus" };
        case 73:
          return { flag: "ð¨ð¿", name: "Czech Republic" };
        case 74:
          return { flag: "ð©ð°", name: "Denmark" };
        case 75:
          return { flag: "ðªðª", name: "Estonia" };
        case 76:
          return { flag: "ð«ð®", name: "Finland" };
        case 77:
          return { flag: "ð«ð·", name: "France" };
        case 78:
          return { flag: "ð©ðª", name: "Germany" };
        case 79:
          return { flag: "ð¬ð·", name: "Greece" };
        case 80:
          return { flag: "ð­ðº", name: "Hungary" };
        case 81:
          return { flag: "ð®ð¸", name: "Iceland" };
        case 82:
          return { flag: "ð®ðª", name: "Ireland" };
        case 83:
          return { flag: "ð®ð¹", name: "Italy" };
        case 84:
          return { flag: "ð±ð»", name: "Latvia" };
        case 85:
          return { flag: "ð±ð¸", name: "Lesotho" };
        case 86:
          return { flag: "ð±ð®", name: "Lichtenstein" };
        case 87:
          return { flag: "ð±ð¹", name: "Lithuania" };
        case 88:
          return { flag: "ð±ðº", name: "Luxembourg" };
        case 89:
          return { flag: "ð²ð°", name: "F.Y.R of Macedonia" };
        case 90:
          return { flag: "ð²ð¹", name: "Malta" };
        case 91:
          return { flag: "ð²ðª", name: "Montenegro" };
        case 92:
          return { flag: "ð²ð¿", name: "Mozambique" };
        case 93:
          return { flag: "ð³ð¦", name: "Namibia" };
        case 94:
          return { flag: "ð³ð±", name: "Netherlands" };
        case 95:
          return { flag: "ð³ð¿", name: "New Zealand" };
        case 96:
          return { flag: "ð³ð´", name: "Norway" };
        case 97:
          return { flag: "ðµð±", name: "Poland" };
        case 98:
          return { flag: "ðµð¹", name: "Portugal" };
        case 99:
          return { flag: "ð·ð´", name: "Romania" };
        case 100:
          return { flag: "ð·ðº", name: "Russia" };
        case 101:
          return { flag: "ð·ð¸", name: "Serbia" };
        case 102:
          return { flag: "ð¸ð°", name: "Slovakia" };
        case 103:
          return { flag: "ð¸ð®", name: "Slovenia" };
        case 104:
          return { flag: "ð¿ð¦", name: "South Africa" };
        case 105:
          return { flag: "ðªð¸", name: "Spain" };
        case 106:
          return { flag: "ð¸ð¿", name: "Swaziland" };
        case 107:
          return { flag: "ð¸ðª", name: "Sweden" };
        case 108:
          return { flag: "ð¨ð­", name: "Switzerland" };
        case 109:
          return { flag: "ð¹ð·", name: "Turkey" };
        case 110:
          return { flag: "ð¬ð§", name: "United Kingdom" };
        case 111:
          return { flag: "ð¿ð²", name: "Zambia" };
        case 112:
          return { flag: "ð¿ð¼", name: "Zimbabwe" };
        case 113:
          return { flag: "ð¦ð¿", name: "Azerbaijan" };
        case 114:
          return {
            flag: "ð²ð·",
            name: "Mauritania (Islamic Republic of Mauritania)",
          };
        case 115:
          return { flag: "ð²ð±", name: "Mali (Republic of Mali)" };
        case 116:
          return { flag: "ð³ðª", name: "Niger (Republic of Niger)" };
        case 117:
          return { flag: "ð¹ð©", name: "Chad (Republic of Chad)" };
        case 118:
          return { flag: "ð¸ð©", name: "Sudan (Republic of the Sudan)" };
        case 119:
          return { flag: "ðªð·", name: "Eritrea (State of Eritrea)" };
        case 120:
          return { flag: "ð©ð¯", name: "Djibouti (Republic of Djibouti)" };
        case 121:
          return { flag: "ð¸ð´", name: "Somalia (Somali Republic)" };

        case 128:
          return { flag: "ð¹ð¼", name: "Taiwan" };
        case 136:
          return { flag: "ð°ð·", name: "South Korea" };
        case 144:
          return { flag: "ð­ð°", name: "Hong Kong" };
        case 145:
          return { flag: "ð²ð´", name: "Macao" };
        case 152:
          return { flag: "ð®ð©", name: "Indonesia" };
        case 153:
          return { flag: "ð¸ð¬", name: "Singapore" };
        case 154:
          return { flag: "ð¹ð­", name: "Thailand" };
        case 155:
          return { flag: "ðµð­", name: "Philippines" };
        case 156:
          return { flag: "ð²ð¾", name: "Malaysia" };
        case 160:
          return { flag: "ð¨ð³", name: "China" };

        case 168:
          return { flag: "ð¦ðª", name: "U.A.E." };
        case 169:
          return { flag: "ð®ð³", name: "India" };
        case 170:
          return { flag: "ðªð¬", name: "Egypt" };
        case 171:
          return { flag: "ð´ð²", name: "Oman" };
        case 172:
          return { flag: "ð¶ð¦", name: "Qatar" };
        case 173:
          return { flag: "ð°ð¼", name: "Kuwait" };
        case 174:
          return { flag: "ð¸ð¦", name: "Saudi Arabia" };
        case 175:
          return { flag: "ð¸ð¾", name: "Syria" };
        case 176:
          return { flag: "ð§ð­", name: "Bahrain" };
        case 177:
          return { flag: "ð¯ð´", name: "Jordan" };

        default:
          return { flag: "ð³ï¸", name: "Unknown country" };
      }
    }

    function toggleOpen(id) {
      const element = document.getElementById(id);
      if (element.style.display === "none") {
        element.style.display = "flex";
        localStorage.setItem(id, "open");
      } else {
        element.style.display = "none";
        localStorage.setItem(id, "closed");
      }
    }
  </script>
</html>